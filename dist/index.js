import l from"arg";function g(t){let s=new URL(t).searchParams.get("argv"),e=[];return s!==null&&(e=s.split(" ")),e}async function y(t,s){if(t.headers.get("authorization")!==`Bearer ${process.env.RCMD_SECRET}`)return{status:401,body:{success:!1}};try{let r=g(t.url);return await s(r),{status:200,body:{success:!0}}}catch(r){return{status:500,body:{success:!1,error:r}}}}var o=class{_spec;_action;constructor(s,e){this._spec=s,this._action=e}parse(s){if(this._action!==null&&this._spec!==null)return y(s,async e=>{let r=l(this._spec,{permissive:!1,argv:e.slice(3)}),{_:n,...i}=r,c=Object.entries(i).reduce((a,[u,p])=>(a[u.replace("--","")]=p,a),{});await this._action(...n,c)})}};export{o as Command,g as parseCmdUrl,y as processCmdReq};
//# sourceMappingURL=index.js.map